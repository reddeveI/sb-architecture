###### 1. Построить и отразить на схеме инфраструктуру, которая будет переносить отказы функциональных узлов и в случае полного отказа быстро восстанавливаться. Восстановление вашей системы должно учитывать критичность функционала, который предоставляет каждый из сервисов: что-то надо восстановить в первую очередь, а что-то может и подождать.

### Инфраструктура с использованием Docker-контейнеров
![alt tag](https://github.com/reddeveI/sb-architecture/blob/main/images/Infrastructure-2.jpg)

* Оркестрация посредством Kuberenetes
* Для работы с браузерами клиентов и сотрудников службы доставки используем гео-балансировщик, который будет распределять нагрузку между 2 серверами
* На каждом сервере расположен кластер, включающий в себя несколько модулей для работы с приложениями клиентов и сотрудников службы доставки.  
* Серверы обращаются к двум изоированным БД: клиентов и заказов и создание ассортимента мебели (включает информацию обо всех комплектующих и деталях для единиц мебели)
* Также серверы обращаются к NFS для работы с файлами
* Сотрудники обращаются к отдельному серверу, в котором происходит бизнес-логика в и обращение к базам данных и NFS 
* Помимо пользовательских и внешних БД, сервер 3 обращается к БД внутренних сервисов (содержит информацию о сотрудниках, аудит и тд, не имеющего отношения непосредственно к работе с клиентом)

###### 2. Выбрать и обосновать стратегию выката новых версий сервисов:
- для тестирования новой технологии;
- для минорного изменения без времени простоя;
- для мажорного обновления без сохранения обратной совместимости работы с базой данных.

### Схема деплоя
![alt tag](https://github.com/reddeveI/sb-architecture/blob/main/images/Deployment.jpg)
* Для деплоя будем использовать канареечные релизы во внешнем контуре (слубжа доставки и клиенты)
* Добавим еще один элемент Kubernetes-оператор Flagger. 
* С его помощью постепенно переключать трафик на канареечный сервер: deployment канареечный и deployment основной для клиентских серверов
* Для сервера сотрудников Flagger накатывает обновления через отдельный основной deployment и при этом используется A/B развертывание с использвоанием feature toggles

* Для тестиования новой технологии - канареечное развертывание для клиентской функциональности и повторное создание для серверов сотрудников
* Для минорной доработки без времени простоя - канареечное развертывание для клиентской функциональности и А/B развертывание с использвоанием feature toggles для сотрудников
* Для мажорного обновления без обратной совместимости с БД - для клиентской функциональности и сотрудников - А/B развертывание с использвоанием feature toggles


###### 3. Указать необходимость стендов (и каких) для проведения тестирования (БД, серверы, оркестраторы и так далее).
* ИФТ - полный контур без балансировки, деплой повторным созданием серверов в тех.окно 
* HotFix - полный контур без балансировки, деплой повторным созданием серверов в тех.окно, содержит бэкап БД не более недели (клиентские данные, естественно, зачищены)
* Нагрузочное тестирование - контур с серверами клиентской функциональности (1 и 2), деплой повторным созданием серверов в тех.окно, не имеет своей БД - обращается к БД Hotfix на чтение
* ПреПрод - полный контур с балансировкой и схемой деплоя, аналогичной prod-среде - для тестирования всего жизненного цикла работы с версиями приложений 
